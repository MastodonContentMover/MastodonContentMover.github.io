<!DOCTYPE HTML>
<html lang="en">
<head>
<!-- Generated by javadoc (17) on Sun Jul 30 19:09:19 JST 2023 -->
<title>Authenticator</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="dc.created" content="2023-07-30">
<meta name="description" content="declaration: package: io.github.mastodonContentMover, class: Authenticator">
<meta name="generator" content="javadoc/ClassWriterImpl">
<link rel="stylesheet" type="text/css" href="../../../stylesheet.css" title="Style">
<link rel="stylesheet" type="text/css" href="../../../script-dir/jquery-ui.min.css" title="Style">
<link rel="stylesheet" type="text/css" href="../../../jquery-ui.overrides.css" title="Style">
<script type="text/javascript" src="../../../script.js"></script>
<script type="text/javascript" src="../../../script-dir/jquery-3.6.0.min.js"></script>
<script type="text/javascript" src="../../../script-dir/jquery-ui.min.js"></script>
</head>
<body class="class-declaration-page">
<script type="text/javascript">var evenRowColor = "even-row-color";
var oddRowColor = "odd-row-color";
var tableTab = "table-tab";
var activeTableTab = "active-table-tab";
var pathtoroot = "../../../";
loadScripts(document, 'script');</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<div class="flex-box">
<header role="banner" class="flex-header">
<nav role="navigation">
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="top-nav" id="navbar-top">
<div class="skip-nav"><a href="#skip-navbar-top" title="Skip navigation links">Skip navigation links</a></div>
<ul id="navbar-top-firstrow" class="nav-list" title="Navigation">
<li><a href="package-summary.html">Package</a></li>
<li class="nav-bar-cell1-rev">Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../index-all.html">Index</a></li>
<li><a href="../../../help-doc.html#class">Help</a></li>
</ul>
</div>
<div class="sub-nav">
<div>
<ul class="sub-nav-list">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method-summary">Method</a></li>
</ul>
<ul class="sub-nav-list">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method-detail">Method</a></li>
</ul>
</div>
<div class="nav-list-search"><label for="search-input">SEARCH:</label>
<input type="text" id="search-input" value="search" disabled="disabled">
<input type="reset" id="reset-button" value="reset" disabled="disabled">
</div>
</div>
<!-- ========= END OF TOP NAVBAR ========= -->
<span class="skip-nav" id="skip-navbar-top"></span></nav>
</header>
<div class="flex-content">
<main role="main">
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<div class="sub-title"><span class="package-label-in-type">Package</span>&nbsp;<a href="package-summary.html">io.github.mastodonContentMover</a></div>
<h1 title="Class Authenticator" class="title">Class Authenticator</h1>
</div>
<div class="inheritance" title="Inheritance Tree"><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html" title="class or interface in java.lang" class="external-link">java.lang.Object</a>
<div class="inheritance">io.github.mastodonContentMover.Authenticator</div>
</div>
<section class="class-description" id="class-description">
<hr>
<div class="type-signature"><span class="modifiers">public class </span><span class="element-name type-name-label">Authenticator</span>
<span class="extends-implements">extends <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html" title="class or interface in java.lang" class="external-link">Object</a></span></div>
<div class="block">Handles the process of authenticating a connection with a Mastodon instance, using an
   OAuth callback facilitated by <a href="OAuthListener.html" title="class in io.github.mastodonContentMover"><code>OAuthListener</code></a> â€” 
   a minimal HTTP server that runs briefly on the local machine to receive a call from 
   the browser on that machine to the <code>localhost</code>.
   <br/><br/>
   Uses the singleton model - for current (and anticipated) use cases, there should not
   be a need for more than one <a href="Authenticator.html" title="class in io.github.mastodonContentMover"><code>Authenticator</code></a> object
   to be instantiated simultaneously. 
   <br/><br/>
   Credentials for the client and the user account are saved and retrieved from the
   filesystem in XML format using <a href="ClientCredentialStore.html" title="class in io.github.mastodonContentMover"><code>ClientCredentialStore</code></a> 
   and <a href="UserCredentialStore.html" title="class in io.github.mastodonContentMover"><code>UserCredentialStore</code></a> respectively.
   <br/><br/>
   Credentials are not persisted when connecting via a custom port (maybe this could
   be changed if there is a significant need for it, but it would require a rework of 
   the data structure used to save credentials and the need for a custom port is 
   expected to be a rare use case anyway).
   <br/><br/></div>
<dl class="notes">
<dt>Since:</dt>
<dd>0.01.00</dd>
<dt>See Also:</dt>
<dd>
<ul class="see-list">
<li><a href="OAuthListener.html" title="class in io.github.mastodonContentMover"><code>OAuthListener</code></a></li>
</ul>
</dd>
</dl>
</section>
<section class="summary">
<ul class="summary-list">
<!-- ========== METHOD SUMMARY =========== -->
<li>
<section class="method-summary" id="method-summary">
<h2>Method Summary</h2>
<div id="method-summary-table">
<div class="table-tabs" role="tablist" aria-orientation="horizontal"><button id="method-summary-table-tab0" role="tab" aria-selected="true" aria-controls="method-summary-table.tabpanel" tabindex="0" onkeydown="switchTab(event)" onclick="show('method-summary-table', 'method-summary-table', 3)" class="active-table-tab">All Methods</button><button id="method-summary-table-tab1" role="tab" aria-selected="false" aria-controls="method-summary-table.tabpanel" tabindex="-1" onkeydown="switchTab(event)" onclick="show('method-summary-table', 'method-summary-table-tab1', 3)" class="table-tab">Static Methods</button><button id="method-summary-table-tab2" role="tab" aria-selected="false" aria-controls="method-summary-table.tabpanel" tabindex="-1" onkeydown="switchTab(event)" onclick="show('method-summary-table', 'method-summary-table-tab2', 3)" class="table-tab">Instance Methods</button><button id="method-summary-table-tab4" role="tab" aria-selected="false" aria-controls="method-summary-table.tabpanel" tabindex="-1" onkeydown="switchTab(event)" onclick="show('method-summary-table', 'method-summary-table-tab4', 3)" class="table-tab">Concrete Methods</button></div>
<div id="method-summary-table.tabpanel" role="tabpanel">
<div class="summary-table three-column-summary" aria-labelledby="method-summary-table-tab0">
<div class="table-header col-first">Modifier and Type</div>
<div class="table-header col-second">Method</div>
<div class="table-header col-last">Description</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>protected social.bigbone.MastodonClient</code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#getClient(java.lang.String,java.lang.String,java.lang.Integer)" class="member-name-link">getClient</a><wbr>(<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>&nbsp;instance,
 <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>&nbsp;username,
 <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Integer.html" title="class or interface in java.lang" class="external-link">Integer</a>&nbsp;customPort)</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">Obtains an authenticated <code>MastodonClient</code> object for the
   specified user account on the specified Mastodon instance, using saved credentials
   from previous use of the tool or by exhausting the various possible methods of 
   authentication in order of preference.</div>
</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4"><code>protected static <a href="Authenticator.html" title="class in io.github.mastodonContentMover">Authenticator</a></code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4"><code><a href="#getSingletonInstance()" class="member-name-link">getSingletonInstance</a>()</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4">
<div class="block">Obtains a reference to the currently instantiated <a href="Authenticator.html" title="class in io.github.mastodonContentMover"><code>Authenticator</code></a>
   singleton object, or instantiates one if that has not already been done.</div>
</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>protected void</code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#oAuthCallback(java.lang.String)" class="member-name-link">oAuthCallback</a><wbr>(<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>&nbsp;code)</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">Passes an OAuth callback code received by an instance of <a href="OAuthListener.html" title="class in io.github.mastodonContentMover"><code>OAuthListener</code></a>
   (which runs a separate thread) to this object, so it can then be collected by <a href="#getClient(java.lang.String,java.lang.String,java.lang.Integer)"><code>getClient(String instance, String username, Integer customPort)</code></a>
   to perform further authentication tasks.</div>
</div>
</div>
</div>
</div>
<div class="inherited-list">
<h3 id="methods-inherited-from-class-java.lang.Object">Methods inherited from class&nbsp;java.lang.<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html" title="class or interface in java.lang" class="external-link">Object</a></h3>
<code><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html#clone()" title="class or interface in java.lang" class="external-link">clone</a>, <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html#equals(java.lang.Object)" title="class or interface in java.lang" class="external-link">equals</a>, <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html#finalize()" title="class or interface in java.lang" class="external-link">finalize</a>, <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html#getClass()" title="class or interface in java.lang" class="external-link">getClass</a>, <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html#hashCode()" title="class or interface in java.lang" class="external-link">hashCode</a>, <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html#notify()" title="class or interface in java.lang" class="external-link">notify</a>, <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html#notifyAll()" title="class or interface in java.lang" class="external-link">notifyAll</a>, <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html#toString()" title="class or interface in java.lang" class="external-link">toString</a>, <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html#wait()" title="class or interface in java.lang" class="external-link">wait</a>, <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html#wait(long)" title="class or interface in java.lang" class="external-link">wait</a>, <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html#wait(long,int)" title="class or interface in java.lang" class="external-link">wait</a></code></div>
</section>
</li>
</ul>
</section>
<section class="details">
<ul class="details-list">
<!-- ============ METHOD DETAIL ========== -->
<li>
<section class="method-details" id="method-detail">
<h2>Method Details</h2>
<ul class="member-list">
<li>
<section class="detail" id="getSingletonInstance()">
<h3>getSingletonInstance</h3>
<div class="member-signature"><span class="modifiers">protected static</span>&nbsp;<span class="return-type"><a href="Authenticator.html" title="class in io.github.mastodonContentMover">Authenticator</a></span>&nbsp;<span class="element-name">getSingletonInstance</span>()</div>
<div class="block">Obtains a reference to the currently instantiated <a href="Authenticator.html" title="class in io.github.mastodonContentMover"><code>Authenticator</code></a>
   singleton object, or instantiates one if that has not already been done.
   <br/><br/></div>
<dl class="notes">
<dt>Returns:</dt>
<dd>a reference to an <a href="Authenticator.html" title="class in io.github.mastodonContentMover"><code>Authenticator</code></a> object
   <br/><br/></dd>
<dt>Since:</dt>
<dd>0.01.00</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="getClient(java.lang.String,java.lang.String,java.lang.Integer)">
<h3>getClient</h3>
<div class="member-signature"><span class="modifiers">protected</span>&nbsp;<span class="return-type">social.bigbone.MastodonClient</span>&nbsp;<span class="element-name">getClient</span><wbr><span class="parameters">(<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>&nbsp;instance,
 <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>&nbsp;username,
 <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Integer.html" title="class or interface in java.lang" class="external-link">Integer</a>&nbsp;customPort)</span>
                                           throws <span class="exceptions">jakarta.xml.bind.JAXBException,
<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/io/IOException.html" title="class or interface in java.io" class="external-link">IOException</a>,
social.bigbone.api.exception.BigBoneRequestException</span></div>
<div class="block">Obtains an authenticated <code>MastodonClient</code> object for the
   specified user account on the specified Mastodon instance, using saved credentials
   from previous use of the tool or by exhausting the various possible methods of 
   authentication in order of preference.
   <br/><br/>
   The sequence of steps for OAuth authentication is as follows:
   <ol>
      <li>Authenticating the client with the Mastodon instance, to obtain a client
      key and secret</li>
      <li>Using the client key to obtain an OAuth URL</li>
      <li>Accessing the URL while logged in with the user account within the browwer
      to obtain an OAuth callback code, sent within the callback request after the
      user authorizes the tool</li>
      <li>Using the client key, secret and callback code to obtain an access token
      that can then be used with user-level API methods</li>
      <li>Using that access token to build an authenticated <code>MastodonClient</code>
      object</li>
   </ol>
   <br/><br/>
   This method:
   <ol>
      <li>Attempts to load an existing access token for a user from file (saved from
      previous use of the tool</li>
      <li>If a token is not available, attempts to load existing client credentials
      from file (saved from previous use of the tool)</li>
      <li>If client credentials are not available, registers the tool as a client to 
      obtain a client key and secret that can be used to obtain an access token via 
      OAuth authorization</li>
      <li>Uses the client key (loaded or obtained) to load an OAuth URL and obtain a 
      callback code, and then uses the client key and secret together with the 
      callback code to obtain an access token for the user account logged in
      in the browser</li>
      <li>Once the user-level access token is obtained (either loaded from file or
      via OAuth), it is used to build an authenticated  <code>MastodonClient</code></li>
   </ol>
   <br/><br/>
   OAuth authorization is preferred as it is most likely to accommodate browser-based
   security measures such as two-factor authentication. There is currently no check
   within the tool to ensure that the Mastodon user account logged in to the given 
   instance within the browser when OAuth authorization is given matches the user 
   account provided as a command-line parameter to this tool (TODO: fix this).
   <br/><br/>
   Both read and write access is requested irrespective of the operation being 
   performed, because the scope must be specified as part of the client registration
   for all operations the client will perform on the given Mastodon instance. If 
   write access was only requested on occasions when statuses were being reposted
   from an archive, it would be necessary to maintain two separate sets of client
   credentials for each instance (one with read access, and one with write access)
   or renew tokens each time the tool was run.
   <br/><br/>
   OAuth authorization is implemented using a minimal HTTP server that runs briefly 
   on the local machine (while the user reviews the OAuth permission web page on the
   specified Mastodon instance and chooses whether or not to authorize the tool). 
   A <code>localhost</code> URL is passed on a call to the Mastodon <code>/oauth/authorize</code>
   endpoint, so the OAuth token is sent by the instance on callback to the temporary 
   HTTP server on the local machine. Once this is detected, the HTTP server is shut
   down.
   <br/><br/>
   This HTTP server runs on the port specified in the constant <code>DEFAULT_PORT</code>,
   set at time of writing to 8081. In the event that this port is already in use 
   on the local machine, it is possible to run this tool using a custom port that can
   be specified here as a parameter
 
   Credentials are not saved to or loaded from file when connecting via a custom 
   port (OAuth or another method of authentication must be used every time the tool
   is run). Approaching this differently would require quite a significant rework of
   the data structure used to save credentials, and the need for a custom port is 
   already expected to be a rare use case. Both user and client credential storage
   would need to be rewritten, as the port must be given as part of the callback URL
   submitted during client registration (you cannot register the client once and then
   re-use that client registration for OAuth user authorization irrespective of
   callback port.
   <br/><br/>
   Alternative ways to obtain an access token include the <code>getUserAccessTokenWithPasswordGrant</code>
   method offered by the BigBone library's OAuthMethods.kt, and manual entry of an
   access token. Currently neither of these are supported, but they could and should
   be so the tool can still be used in the event of an issue with OAuth authorization
   (TODO). Obviously typing in an access token manually would be cumbersome; perhaps
   it could be a command-line parameter.
   <br/><br/></div>
<dl class="notes">
<dt>Parameters:</dt>
<dd><code>instance</code> - the hostname or address of the Mastodon instance with which this
                   method should authenticate</dd>
<dd><code>username</code> - the username for the account on the Mastodon instance with which this
                   method should authenticate</dd>
<dd><code>customPort</code> - a valid port that can be bound on the local machine to briefly 
                     run an 
   <br/><br/></dd>
<dt>Returns:</dt>
<dd>an authenticated <code>MastodonClient</code>
   <br/><br/></dd>
<dt>Throws:</dt>
<dd><code>social.bigbone.api.exception.BigBoneRequestException</code> - (TODO: add more info here on when this happens)</dd>
<dd><code>jakarta.xml.bind.JAXBException</code> - (TODO: add more info here on when this happens)</dd>
<dd><code><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/io/IOException.html" title="class or interface in java.io" class="external-link">IOException</a></code> - (TODO: add more info here on when this happens)
   <br/><br/></dd>
<dt>Since:</dt>
<dd>0.01.00</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="oAuthCallback(java.lang.String)">
<h3>oAuthCallback</h3>
<div class="member-signature"><span class="modifiers">protected</span>&nbsp;<span class="return-type">void</span>&nbsp;<span class="element-name">oAuthCallback</span><wbr><span class="parameters">(<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>&nbsp;code)</span></div>
<div class="block">Passes an OAuth callback code received by an instance of <a href="OAuthListener.html" title="class in io.github.mastodonContentMover"><code>OAuthListener</code></a>
   (which runs a separate thread) to this object, so it can then be collected by <a href="#getClient(java.lang.String,java.lang.String,java.lang.Integer)"><code>getClient(String instance, String username, Integer customPort)</code></a>
   to perform further authentication tasks.
   <br/><br/></div>
<dl class="notes">
<dt>Parameters:</dt>
<dd><code>code</code> - the OAuth callback code
   <br/><br/></dd>
<dt>Since:</dt>
<dd>0.01.00</dd>
<dt>See Also:</dt>
<dd>
<ul class="see-list-long">
<li><a href="OAuthListener.html" title="class in io.github.mastodonContentMover"><code>OAuthListener</code></a></li>
<li><a href="#getClient(java.lang.String,java.lang.String,java.lang.Integer)"><code>getClient(String instance, String username, Integer customPort)</code></a></li>
</ul>
</dd>
</dl>
</section>
</li>
</ul>
</section>
</li>
</ul>
</section>
<!-- ========= END OF CLASS DATA ========= -->
</main>
</div>
</div>
</body>
</html>
